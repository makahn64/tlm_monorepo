# Aphrodite Legacy Code Audit

**Date:** November 26, 2025  
**Purpose:** Document existing features in legacy Aphrodite for migration planning

## Overview

Legacy Aphrodite is a Create React App built in 2021 using:
- React 16.13
- TypeScript 4.0
- Firebase 7.21
- React Router 5
- React Bootstrap / Reactstrap
- Ant Design components

## Core Features

### 1. Authentication
**Location:** `src/pages/auth/LoginPage.tsx`

- Email/password login via Firebase Auth
- Custom auth state management (`AuthProvider2State`)
- Shows login page when not authenticated
- **Security Issue:** Default password `Aphrodite21++)` for new trainers

**Migration Priority:** HIGH (needed for everything else)

### 2. Dashboard
**Location:** `src/pages/dashboard/DashboardPage.tsx`

- Landing page after login
- Likely shows stats and quick actions
- **Need to audit:** What's actually displayed

**Migration Priority:** MEDIUM

### 3. Client Management
**Location:** `src/pages/clients/`

**Features:**
- List all clients (`ClientListPage.tsx`)
- Add/edit client (`AddEditClientPage.tsx`)
- Client details view (`ClientDetailsPage.tsx`)
- Client management hub (`ClientManagementPage.tsx`)
- Client notes (`ClientNotesPage.tsx`)
- Health status tracking (`ClientHealthStatusForm.tsx`)
- Equipment tracking (`EquipmentForm.tsx`)
- Contact information (`ClientContactForm.tsx`)
- Trainer recommendations (`ClientAddRecommendationPage.tsx`, `TrainerRecommendationEditor.tsx`)

**Client Data Model:**
- Personal info (name, email, phone, DOB)
- Pregnancy status (due date, isPregnant, tryingToConceive)
- Fitness level (beginner/intermediate/advanced)
- Client type (active, paused, pastDue, lead, archived, free, appSub0-3)
- Equipment available (bodyWeight, chair, ball, band, etc.)
- Injuries/conditions (backPain, sciatica, posture, various injuries)
- Theme preference
- Workout history
- Account status

**Migration Priority:** HIGH (core business feature)

### 4. Exercise Management
**Location:** `src/pages/exercises/`

**Features:**
- List exercises (`ExerciseListPage.tsx`)
- Add/edit exercise (`AddEditExercisePage.tsx`)
- Exercise details (`ExerciseDetailPage.tsx`)

**Exercise Data Model:**
- Title and name
- Description and cues
- Movement pattern (warm-up, hinge, squat, lunge, rotation, push, pull, carry, core)
- Intensity level (1-10)
- Duration
- Equipment required/optional
- Stress factors (unilateral, twisting, high pressure, etc.)
- Releases (muscle groups)
- Activates (muscle groups)
- Videos (prenatal, postnatal, instruction)
- Thumbnails
- Published status
- Archived status
- Custom exercise flag
- Break exercise flag

**Migration Priority:** HIGH (core content)

### 5. Workout Management
**Location:** `src/pages/workouts/`

**Features:**
- Client workout list (`ClientWorkoutsPage.tsx`)
- Workout detail view (`ClientWorkoutDetailPage.tsx`)
- Add workout to client (`ClientAddWorkoutPage.tsx`)
- Workout editor (`WorkoutEditor.tsx`, `workoutEditor/`)
- Workout history (`ClientWorkoutHistoryPage.tsx`, `WorkoutHistoryTable.tsx`)

**Workout Data Model:**
- Name (optional, for client)
- List of exercises
- Created by (trainer name)
- Generated by (trainer or algorithm)
- Duration
- Workout type (normal or mobility)
- Client notes and internal notes
- Feedback
- Progress tracking (status, exercise index, playback time, rounds)
- Favorite flag
- Timestamps (created, started, completed)
- Client snapshot (client state when workout created)
- Prioritizations and eliminations

**Migration Priority:** HIGH (core feature)

### 6. Prebuilt Workouts
**Location:** `src/pages/prebuiltWorkouts/`

**Features:**
- List prebuilt workouts (`PrebuiltWorkoutListPage.tsx`)
- Add/edit prebuilt workout (`AddEditPrebuiltWorkoutPage.tsx`)

**Prebuilt Workout:**
- Same as regular workout
- Plus: authorId, visibility (TLM/private/shared)
- Reusable templates trainers can assign to clients

**Migration Priority:** MEDIUM

### 7. Lead Management
**Location:** `src/pages/leads/`

**Features:**
- List leads (`LeadListPage.tsx`, `LeadTable.tsx`)
- Process lead (`LeadDetailPage.tsx`)

**Lead Data Model:**
- Contact info (email, firstName, lastName)
- Created date
- Processed date
- Disposition (unprocessed, accepted, dropped)
- Profile state (pregnancy info, concerns, interests)

**Migration Priority:** LOW (if feature is being used)

### 8. User/Team Management
**Location:** `src/pages/users/`

**Features:**
- List team members (`UserListPage.tsx`)
- Add/edit user (`AddEditUserPage.tsx`)

**User Data Model:**
- Name and email
- UID (Firebase Auth)
- isAdmin flag
- isTrainer flag
- List of client IDs

**Migration Priority:** MEDIUM

### 9. Media Management
**Location:** `src/pages/media/`

**Features:**
- List all media (`MediaListPage.tsx`)
- Media by type (`MediaOfTypePage.tsx`)
- Media details (`MediaDetailPage.tsx`)
- Add/edit media (`AddEditMediaPage.tsx`)

**Purpose:** Manage video files in Cloud Storage

**Migration Priority:** MEDIUM (needed for exercise videos)

### 10. Account Management
**Location:** `src/pages/account/AccountManagementPage.tsx`

- User's own account settings
- Likely password change, profile update

**Migration Priority:** LOW

## Technical Architecture

### Services Layer
**Location:** `src/services/`

**Firebase Services** (`firebase/`):
- Firebase initialization
- Auth state management
- Firestore queries
- Storage operations

**GCF Services** (`gcf/`):
- Cloud Functions API calls
- JWT-based requests
- Client creation
- User creation
- Stats retrieval

**Browser Storage** (`browserStorage/`):
- Local storage utilities

**UI Services** (`ui/`):
- UI state management (UIProvider)
- Toast notifications (react-toastify)

### Custom Hooks
**Location:** `src/hooks/`

- `useClient.ts` - Client data fetching
- `useExercises.ts` - Exercise data fetching
- `useUser.ts` - User data fetching

### Components
**Location:** `src/components/`

Extensive component library:
- Action menus
- Badges
- Cards
- Cells
- Charts
- Containers
- Data display
- Form elements
- Images
- Layout
- Messages
- Modals
- Navigation (TLMNavbar)
- Pickers
- Tables
- Tiles
- Typography

**Note:** Many of these are wrappers around Bootstrap/Ant Design

### Shared Code
**Location:** `legacy/tlm-common/`

Shared package with:
- Type definitions
- Data models
- Constants
- Utility functions

**Migration:** Extract to `@lotus/shared-types` and `@lotus/business-logic`

## Data Flow

1. **Authentication:** Firebase Auth → AuthProvider2State → App shows/hides content
2. **Data Fetching:** Custom hooks → Firestore queries → Component state
3. **Data Mutations:** Component → GCF API call or direct Firestore write
4. **Navigation:** React Router with URL params for IDs

## Issues & Technical Debt

### Critical Issues
1. **Default passwords** - Security vulnerability
2. **No environments** - Testing in production
3. **Mixed concerns** - Business logic in components
4. **Old dependencies** - Firebase 7, React 16, etc.

### Code Quality Issues
1. **No TypeScript strict mode** - Loose typing
2. **Any types everywhere** - Lost type safety
3. **Direct Firebase calls in components** - Hard to test
4. **Inconsistent patterns** - Mix of class/function components
5. **Large components** - Some files are very long

### Missing Features
1. **No tests** - Zero test coverage
2. **No error boundaries** - Poor error handling
3. **No loading states** - Inconsistent UX
4. **No offline support** - Requires internet

## Migration Strategy Recommendations

### Phase 1: Foundation (Weeks 1-2)
1. Set up multi-environment Firebase ✅ (DONE)
2. Set up Firebase SDK ✅ (DONE)
3. Create authentication flow
4. Build basic layout/navigation

### Phase 2: Core Features (Weeks 3-8)
Priority order:
1. **Authentication** - Login, logout, password reset
2. **Exercise Management** - List, add, edit, view exercises
3. **Client Management** - List, add, edit, view clients
4. **Workout Management** - Create and assign workouts
5. **User Management** - Manage trainers/admins

### Phase 3: Secondary Features (Weeks 9-12)
1. **Prebuilt Workouts** - Template system
2. **Media Management** - Video file management
3. **Dashboard** - Stats and overview
4. **Lead Management** - If being used

### Phase 4: Polish (Weeks 13-16)
1. **Account Management** - User settings
2. **Workout History** - Historical data views
3. **Notes & Recommendations** - Trainer tools
4. **Charts & Analytics** - Data visualization

## Questions for TLM

Before migrating certain features, clarify:

1. **Lead Management** - Is this feature actively used?
2. **Trial System** - Is the 30-day trial feature being used?
3. **Client Types** - Which client types are actually used? (active, paused, lead, appSub levels)
4. **Prebuilt Workouts** - How important is this feature?
5. **Media Management** - Do trainers upload videos, or is it admin-only?
6. **Workout Algorithm** - Is there an algorithm that generates workouts, or is it all manual?
7. **Charts/Analytics** - What stats are most important to trainers?

## Next Steps

1. Review this audit with Mitch
2. Prioritize features based on actual usage
3. Start with authentication implementation
4. Build one feature end-to-end to establish patterns
5. Iterate on remaining features

---

**Last Updated:** November 26, 2025  
**Audited By:** Kiro AI
